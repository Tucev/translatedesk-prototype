<div id="translator-request-queue" class="span4" ng-controller="PublishController">
  <div class="well">
    <h5>Translator Request Queue</h5>
    <form ng-submit="fetch()">
      <div class="searchbox controls controls-row input-append span12">
        <select ng-model="workbench.provider" class="span4" ng-options="p.name for (id, p) in workbench.providers"></select>
        <input type="text" class="span5" ng-model="postQuery" placeholder="Keyword, #hashtag or @username">
        <button class="btn span3">Search</button>
      </div>

      <label>Sort by</label>
      <select ng-model="sortCriteria" class="span12">
        <option value="popularity">Popularity</option>
        <option value="created_at">Date and Time</option>
        <option value="distance">Location</option>
      </select>

      <label>Sort order</label>
      <select ng-model="sortOrder" class="span12">
        <option value="">Ascending</option>
        <option value="reverse">Descending</option>
      </select>

      <label>Limit</label>
      <select ng-model="searchLimit" ng-change="posts.length && fetch()" class="span12">
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="50">50</option>
        <option value="100">100</option>
      </select>

      <label>Source language handler</label>
      <select ng-model="sourceLanguageHandler" ng-change="posts.length && fetch()" class="span12">
        <option value="provider">Provider ({{workbench.provider.name}})</option>
        <option value="google">Google Translate Auto-Detect</option>
        <option value="langid">Local Language Identification Tool (langid.py)</option>
      </select>

      <label>Filters</label>
      <div ng-include="filterTemplateUrl()"></div>
    </form>
    <div class="message" ng-show="message">{{message}}</div>
    <h5 class="results-count" ng-show="(posts | filter:filterQueue).length">There are {{(posts | filter:filterQueue).length}} posts.</h5>
    <ul class="posts">
      <li class="post" ng-repeat="post in posts | orderBy:sortQueue:sortOrder | filter:filterQueue" ng-include="postTemplateUrl()"></li>
    </ul>
  </div>
</div>
 
<div id="translation-workbench" class="span5" ng-controller="TranslationController">
  <h5>Translation Workbench</h5>
  
  <!-- FIXME: Is there a way to bind variables instead of using ng-repeat? -->
  <div class="translation-workbench-inner" ng-show="workbench.source" ng-repeat="post in [workbench.source]">

    <div id="translation-source" class="well">
      <div ng-include="postTemplateUrl()"></div>
    </div>

    <div id="translation-target" class="well">
      <form ng-submit="publish()">

        <textarea ng-model="translatedPost" ng-init="prepareTranslation(post)" ng-change="updateModel(translatedPost)" class="span12"></textarea>

        <div id="preview" class="modal hide fade in" style="display: none;">
          <div class="modal-header">
            <a class="close" data-dismiss="modal">X</a>
            <h3>Preview</h3>
          </div>
          <div class="modal-body">
            <p>{{previewContent}}</p>
          </div>
          <div class="modal-footer">
            <a href="#" class="btn" data-dismiss="modal">Close</a>
            <input type="submit" value="Publish" class="btn btn-primary" id="publish-post-button" /> <span ng-bind-html-unsafe="publishingMessage"></span>
          </div>
        </div>

        <p class="publish">
          <a class="btn btn-info" ng-click="preview()">Preview &amp; Publish</a> 
        </p>
      </form>
      <p class="counter" ng-class="{ 'post-limit-exausted' : translatedPost.length > workbench.provider.charsLimit }">{{workbench.provider.charsLimit - translatedPost.length}}</p>
      <p class="autosave" ng-show="lastSave.ago">Draft saved {{lastSave.ago}}</p>

      <div class="btn-group open mt">
        <a class="btn btn-mini" href="#">Machine translation</a>
        <a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#">
          <span class="icon-caret-down"></span>
        </a>
        <div class="dropdown-menu" ng-click="$event.stopPropagation()">
          <div class="dropdown-menu-inner">
            <form ng-submit="machineTranslate()">
              <p class="mt-message">{{machineTranslationMessage}}</p>
              <ul>
                <li>
                  <label>Provider</label> 
                  <span>
                    <select ng-change="selectMachineTranslator()" ng-init="getMachineTranslators()" ng-model="machineTranslator" ng-options="provider.name for provider in machineTranslators" required>
                      <option value="">Choose</option>
                    </select>
                  </span>
                </li>
                <li>
                  <label>From</label> 
                  <span>
                    <select ng-model="sourceLanguage" ng-options="language.code as language.name for language in machineTranslator.languages" required>
                      <option value="">Choose</option>
                    </select>
                  </span>
                </li>
                <li>
                  <label>To</label> 
                  <span>
                    <select ng-model="targetLanguage" ng-options="language.code as language.name for language in machineTranslator.languages" required>
                      <option value="">Choose</option>
                    </select>
                  </span>
                </li>
              </ul>
              <p><input type="submit" class="btn btn-mini" value="Translate" /></p>
            </form>
          </div>
        </div>
      </div>

      <div class="workbench-form-footer"></div>
    </div>

    <div id="translations">
      <h5>Translations</h5>
      <ul class="posts">
        <li class="post well well-small" ng-repeat="post in translations">
          <p class="translation-info">Translated to {{post.target_language_readable}} by {{post.author_name}} on {{post.created_at | date:'h:mma Z d MMM yy'}}</p>
          <p class="translation-text">{{post.text}} <span><i class="icon-external-link"></i> <a href="{{post.published_url}}" target="_blank">See online</a></span></p>
        </li>
      </ul>
    </div>

  </div>
</div>

<div id="dictionary" class="span3" ng-controller="DictionaryController">
  <div class="well">
    <h5>Dictionary</h5>
    <div class="message" ng-show="message">{{message}}</div>
    <form ng-submit="search()">
      <p><input type="text" class="span12" ng-model="dictPattern" placeholder="Search & Filter" /></p>
    </form>
    <ul id="dict-words">
      <li ng-repeat="word in dictWords | filter:searchFilter"><span class="dict-word">{{word.original}}</span><span class="dict-meaning">{{word.meaning}}</span></li>
    </ul>
  </div>
</div>
